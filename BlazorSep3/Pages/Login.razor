@page "/Login"
@using System
@using System.Threading.Tasks
@using BlazorSep3.Data
@using BlazorSep3.Authentication
@using BlazorSep3.Shared
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavgMan
@inject IServiceUser _serviceUser;

<div class="main">

    <div class="form-Contanier">
        <div class="header">
            <span> Login </span>
            <br/> <span class="error">@errorMessage</span>
        </div>
        <div class="form-field">
            <div>
                <label class="username">
                    <span class="oi oi-person"/> Username
                </label>
            </div>
            <div>
                <input placeholder="User Name" @bind="@username"/>

            </div>
        </div>
        <div class="form-field">
            <div>
                <label class="password">
                    <span class="oi oi-lock-locked"/> Password
                </label>
            </div>
            <div>
                <input type="password" placeholder="Password" @bind="password"/>

            </div>
        </div>
        <div class="form-field footer">
            <div>
                <button class="btn btn-success" type="submit" @onclick="PerformLogin">Login</button>
            </div>
        </div>
    </div>

</div>




@code {
    [CascadingParameter]
    public MainLayout Layout { get; set; }

    private string username;
    private string password;
    private string errorMessage;

    public async Task PerformLogin()
    {
        try
        {
            await ((CustomAuthenticationStateProvider) AuthenticationStateProvider).ValidateLogin(username, password);
            NavgMan.NavigateTo("/");
        }
        catch (Exception e)
        {
            Console.WriteLine(e.Message);
            errorMessage = e.Message;
        }
    }
          
        
    }
    